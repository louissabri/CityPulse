<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CityPulse API Documentation</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Charter:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-section">
            <div class="nav-brand">
                <svg viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" />
                    <circle cx="12" cy="10" r="3" />
                </svg>
                <span>CityPulse</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">App</a>
                <a href="/api" class="nav-link active">API Docs</a>
            </div>
        </div>
        <div class="nav-section">
            <label class="switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </span>
            </label>
        </div>
    </nav>

    <div class="api-docs">
        <div class="docs-header">
            <h1>CityPulse API Documentation</h1>
            <p class="docs-intro">
                The CityPulse API provides access to intelligent local recommendations powered by Google Maps with AI-enhanced analysis. The system uses advanced natural language processing to understand user queries and deliver conversational, helpful responses.
            </p>
        </div>

        <section class="docs-section">
            <h2>Overview</h2>
            <p>The API uses a combination of AI and Google Places data to provide comprehensive local recommendations:</p>
            <div class="process-flow">
                <div class="process-step">
                    <h3>1. Query Processing</h3>
                    <p>Uses advanced NLP techniques and OpenAI to detect search intent, understand user queries and extract search criteria, requirements, and location information.</p>
                </div>
                <div class="process-step">
                    <h3>2. Location Resolution</h3>
                    <p>Resolves locations using Google Maps API, with built-in support for Sydney neighborhoods and landmarks.</p>
                </div>
                <div class="process-step">
                    <h3>3. Data Collection</h3>
                    <p>Collects place data from Google Maps API, including locations, ratings, reviews, and business details.</p>
                </div>
                <div class="process-step">
                    <h3>4. AI Analysis</h3>
                    <p>OpenAI analyzes venues to identify the best options and highlights key features in a conversational format.</p>
                </div>
            </div>
        </section>

        <section class="docs-section">
            <h2>Endpoints</h2>
            
            <div class="endpoint">
                <h3>Generate Session ID</h3>
                <code class="endpoint-url">POST /generate_session_id</code>
                <p>Creates a unique session ID for maintaining conversation context across requests.</p>
                
                <h4>Request Format</h4>
                <pre><code>// No payload required
{}</code></pre>

                <h4>Response Format</h4>
                <pre><code>{
    "session_id": "string" // Unique session identifier
}</code></pre>
            </div>
            
            <div class="endpoint">
                <h3>Chat</h3>
                <code class="endpoint-url">POST /chat</code>
                <p>The primary endpoint for all interactions. Intelligently detects if a message is a search query and responds accordingly.</p>
                
                <h4>Request Format</h4>
                <pre><code>{
    "message": "string", // Your message (e.g., "Dog friendly beer gardens in Newtown")
    "session_id": "string" // Your session ID (required)
}</code></pre>

                <h4>Response Format for General Chat</h4>
                <pre><code>{
    "response": "string" // Text response from the assistant
}</code></pre>

                <h4>Response Format for Detected Place Searches</h4>
                <pre><code>{
    "response": "string", // Conversational summary of search results (only if session_id provided)
    "places": [
        {
            "name": "string",
            "formatted_address": "string",
            "rating": float,
            "type": ["string"],
            "review": [
                {
                    "rating": float,
                    "text": "string",
                    "author_name": "string"
                }
            ],
            "website": "string",
            "price_level": integer,
            "opening_hours": {
                "open_now": boolean,
                "periods": [...]
            },
            "formatted_phone_number": "string",
            "geometry": {
                "location": {
                    "lat": float,
                    "lng": float
                }
            },
            "place_id": "string"
        }
    ],
    "analysis": {
        "summary": "string",
        "highlights": [
            {
                "place_name": "string",
                "key_features": ["string"]
            }
        ],
        "comparisons": ["string"]
    },
    "query": {
        "original": "string",
        "amenity": "string",
        "requirements": "string",
        "location": "string"
    }
}</code></pre>
            </div>
        </section>

        <section class="docs-section">
            <h2>Example Usage</h2>
            <div class="example">
                <h3>1. Generate Session ID</h3>
                <pre><code>curl -X POST \
    http://localhost:8080/generate_session_id \
    -H 'Content-Type: application/json'</code></pre>

                <h3>2. Send a Search Query</h3>
                <pre><code>curl -X POST \
    http://localhost:8080/chat \
    -H 'Content-Type: application/json' \
    -d '{
        "message": "Dog friendly beer gardens in Newtown",
        "session_id": "your_session_id_here"
    }'</code></pre>

                <h3>Python Example (Complete Flow)</h3>
                <pre><code>import requests
import json

# Step 1: Generate session ID
session_response = requests.post(
    "http://localhost:8080/generate_session_id",
    headers={"Content-Type": "application/json"}
)
session_data = session_response.json()
session_id = session_data.get("session_id")

# Step 2: Send a query
url = "http://localhost:8080/chat"
payload = {
    "message": "Dog friendly beer gardens in Newtown",
    "session_id": session_id
}
headers = {
    "Content-Type": "application/json"
}

response = requests.post(url, json=payload, headers=headers)
results = response.json()

# Step 3: Process the results
if "places" in results:
    # This was processed as a search query
    places = results.get("places", [])
    conversation_response = results.get("response", "")
    
    print(f"Conversation response: {conversation_response}")
    print(f"Found {len(places)} places")
else:
    # This was processed as a general chat message
    print(f"Response: {results.get('response')}")
</code></pre>
            </div>
        </section>

        <section class="docs-section">
            <h2>Search Query Features</h2>
            <p>The system intelligently detects search queries using multiple techniques:</p>
            <ul>
                <li><strong>AI-based intent detection</strong> for complex queries</li>
                <li><strong>Pattern recognition</strong> for locations and amenities</li>
                <li><strong>Context-aware</strong> responses that remember previous search terms</li>
                <li><strong>Auto-extraction</strong> of place types, requirements, and locations</li>
            </ul>
            <p>Examples of queries that are automatically handled:</p>
            <ul>
                <li>"Dog friendly beer gardens in Newtown"</li>
                <li>"Coffee shops with wifi near Sydney CBD"</li>
                <li>"Italian restaurants in Surry Hills"</li>
                <li>"What about in Marrickville?" (as a follow-up to a previous search)</li>
            </ul>
        </section>

        <section class="docs-section">
            <h2>Notes on Rate Limits</h2>
            <p>This service uses external APIs with their own rate limits:</p>
            <ul>
                <li>OpenAI API rate limits apply to all queries</li>
                <li>Google Maps API limits apply to location searches</li>
                <li>Session data is cleaned up after 7 days of inactivity</li>
            </ul>
        </section>
    </div>

    <footer class="app-footer">
        <div class="footer-content">
            <p>&copy; 2024 Louis Sabri. All rights reserved.</p>
            <div class="footer-links">
                <a href="https://github.com/louissabri" target="_blank" rel="noopener noreferrer" title="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <a href="https://www.linkedin.com/in/louissabri/" target="_blank" rel="noopener noreferrer" title="LinkedIn">
                    <i class="fab fa-linkedin"></i>
                </a>
                <a href="https://louissabri.github.io" target="_blank" rel="noopener noreferrer" title="Personal Website">
                    <i class="fas fa-globe"></i>
                </a>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='theme.js') }}"></script>
</body>
</html> 